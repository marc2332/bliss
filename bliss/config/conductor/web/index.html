<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>{{ name if name else "beamlinee" }} configuration application</title>

    <!-- JQuery -->
    <script language="JavaScript" type="text/javascript" src="js/jquery-2.1.3.min.js"></script>

    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- Bootstrap select -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/js/bootstrap-select.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css"></link>

    <!-- JQuery UI -->
    <!-- <script language="JavaScript" type="text/javascript" src="js/jquery-ui.min.js"></script> -->
    <!-- <link rel="stylesheet" href="css/jquery-ui/jquery-ui.min.css"></link> -->

    <!-- JQuery layout -->
    <!-- <script language="JavaScript" type="text/javascript" src="js/jquery.layout.min.js"></script> -->
    <!-- <link rel="stylesheet" href="css/layout-default.min.css"></link> -->

    <!-- jsTree -->
    <script language="JavaScript" type="text/javascript" src="js/jstree.min.js"></script>
    <link rel="stylesheet" href="css/jstree/style.min.css"></link>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js" ></script>

    <script src="js/config_app.js"></script>
    <link rel="stylesheet" href="css/config_app.css"></link>

  </head>
  <body>

    <!-- Main toolbar -->
    <nav class="navbar navbar-default navbar-fixed-top navbar-compact" id="main_toolbar" aria-label="main toolbar">
      <div class="container-fluid">
        <div class="navbar-header">
          <a id="brand_image" class="navbar-brand navbar-brand-img-compact" href="#">
	    <img alt="Beacon" src="res/logo.png" width="48" height="48"></img>
	  </a>

	  <a id="brand_text" class="navbar-brand navbar-brand-compact" href="#">
	    {{ name if name else "Beacon" }}</a>
        </div>

	<!-- Collect the nav links, forms, and other content for toggling -->
	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	  <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="filter_edit" type="text" class="form-control" placeholder="Filter for..."></input>
            </div>
	    <button id="clear_filter" type="button" class="btn btn-default">
	      <span class="fa fa-eraser"></span>
	      Clear filter
	    </button>
	  </form>

	  <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
		 role="button" aria-haspopup="true" aria-expanded="false">Add...<span class="caret"></span></a>
              <ul class="dropdown-menu">
		<li><a id="add_file" href="#">YAML File</a></li>

		{% for plugin, plugin_actions in actions.items() %}
		{% if "add" in plugin_actions %}
		<!-- <li role="separator" class="divider"></li> -->
		<li class="dropdown-header">{{ plugin }}</li>
		{% for action in plugin_actions["add"] %}
		<li>
		  <a id="{{ action['id'] }}" href="#">{{ action['label'] }}</a>
		</li>
		{% endfor %}	    
		{% endif %}
		{% endfor %}
              </ul>
            </li>
	  </ul>

	  <p id="message_box" role="alert" class="navbar-text alert alert-info message-compact">
	    Welcome to {{ name if name else "the beamline" }} configuration application
	  </p>

          <button type="button" class="btn btn-primary navbar-btn navbar-right" id="reload_config"
		  data-loading-text="Reloading..." data-toggle="tooltip" data-placement="left"
		  title="Reloads configuration from the server">
            <span class="fa fa-refresh"></span>
            Reload config
          </button>
	</div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row row-eq-height">
	<!-- Tree panel (left panel) -->
	<div id="tree_panel" class="col-md-3">
	  <div class="with-nav-tabs">
	    <ul class="nav nav-tabs" role="tablist">
	      <li role="presentation" class="active">
		<a href="#files_perspective" aria-controls="files perspective"
		   role="tab" data-toggle="tab">
		  Files
		</a>
	      </li>
	      <li role="presentation">
		<a href="#objects_perspective" aria-controls="objects perspective"
		   role="tab" data-toggle="tab">
		  Objects
		</a>
	      </li>
	      <li role="presentation">
		<a href="#instruments_perspective" aria-controls="instruments perspective"
		   role="tab" data-toggle="tab">
		  Instruments
		</a>
	      </li>
	    </ul>
	    <div id="tree_tabs" class="panel-body">
	      <div class="tab-content">
		<!-- Tree -->
		<div id="files_perspective" class="tab-pane active">
		  <div id="fs_tree" class="jstree beacon-tree files-perspective"></div>
		</div>
		<div id="objects_perspective" class="tab-pane">
		  <div id="obj_tree" class="jstree beacon-tree objects-perspective"></div>
		</div>
		<div id="instruments_perspective" class="tab-pane">
		  <div id="instrument_tree" class="jstree beacon-tree instruments-perspective"><h3>TODO</h3></div>
		</div>
	      </div>
	    </div>
	  </div>
	</div>
	<div id="right_panel" class="col-md-9">
	  <!-- Edit panel (right panel) -->
	  <div id="edit_panel" class="panel-body" style="visibility:hidden">
	    <div id="edit_form" class="" style=""></div>
	  </div>
	</div>
      </div>
    </div>
    <script>
      $(function() {

        $('[data-toggle="tooltip"]').tooltip({'placement': 'top'});

        $("#filter_edit").keyup(function() {
          console.log("filter edit");
          var filter = $(this).val();
          $(".beacon-tree").jstree("search", filter);
        });

        $("#clear_filter").on("click", function() {
          $("#filter_edit").val("");
          $(".beacon-tree").jstree("clear_search");
        });

        $("#add_file").on("click", function() {
          add_file();
        });

        $("#reload_config").on("click", function() {
          var btn = $(this).button('loading');
          request = $.ajax({
            url : "config/reload",
            success: function() {
              tree_reload("#tree_tabs");
            }});
            request.always(function() {
              btn.button('reset');
          });
        });

        $("#brand_image").on("click", function() {
          show_main();
        });

        $("#brand_text").on("click", function() {
          show_main();
        });

        {% for plugin, plugin_actions in actions.items() %}
        {% for group_name, group_actions in plugin_actions.items() %}
        {% for action in group_actions %}
        $("#{{ action['id'] }}").on("click", function() {
          on_plugin_action("{{ plugin }}", "{{ action['action'] }}");
        });
        {% endfor %}	    
        {% endfor %}
        {% endfor %}

        tree_reload("#tree_tabs");
        show_main();

      });
    </script>
  </body>
</html>
